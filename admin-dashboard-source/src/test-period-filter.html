<!DOCTYPE html>
<html>
<head>
    <title>Period Filter Test</title>
</head>
<body>
    <h1>기간별 필터 테스트</h1>
    
    <div>
        <button onclick="testPeriod('daily')">일별 데이터 테스트</button>
        <button onclick="testPeriod('weekly')">주별 데이터 테스트</button>
        <button onclick="testPeriod('monthly')">월별 데이터 테스트</button>
    </div>
    
    <pre id="output"></pre>
    
    <script type="module">
        // 날짜 유틸리티
        const getToday = () => {
            const today = new Date();
            return today.toISOString().split('T')[0];
        };
        
        const getMonthFirstDate = () => {
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            return firstDay.toISOString().split('T')[0];
        };
        
        const getWeekStartDate = () => {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const diffToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            
            const monday = new Date(today);
            monday.setDate(today.getDate() + diffToMonday);
            
            const monthFirst = new Date(today.getFullYear(), today.getMonth(), 1);
            
            // 월요일이 당월 1일보다 이전이면 당월 1일 반환
            if (monday < monthFirst) {
                return monthFirst.toISOString().split('T')[0];
            }
            
            return monday.toISOString().split('T')[0];
        };
        
        const getDateRangeByPeriod = (period) => {
            const today = getToday();
            
            switch (period) {
                case 'daily':
                    return {
                        startDate: today,
                        endDate: today
                    };
                    
                case 'weekly':
                    return {
                        startDate: getWeekStartDate(),
                        endDate: today
                    };
                    
                case 'monthly':
                    return {
                        startDate: getMonthFirstDate(),
                        endDate: today
                    };
                    
                default:
                    return {
                        startDate: today,
                        endDate: today
                    };
            }
        };
        
        window.testPeriod = async function(period) {
            const output = document.getElementById('output');
            output.textContent = `Testing ${period}...\n\n`;
            
            try {
                // 날짜 범위 계산
                const dateRange = getDateRangeByPeriod(period);
                output.textContent += `Period: ${period}\n`;
                output.textContent += `Start Date: ${dateRange.startDate}\n`;
                output.textContent += `End Date: ${dateRange.endDate}\n\n`;
                
                // API 호출 테스트
                const token = localStorage.getItem('token');
                const response = await fetch(`http://localhost:5100/api/settlement-api/dashboard?startDate=${dateRange.startDate}&endDate=${dateRange.endDate}`, {
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                
                const data = await response.json();
                output.textContent += 'API Response:\n';
                output.textContent += JSON.stringify(data, null, 2);
                
            } catch (error) {
                output.textContent += 'Error: ' + error.message;
            }
        };
    </script>
</body>
</html>