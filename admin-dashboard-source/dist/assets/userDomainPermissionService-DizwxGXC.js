import{a as d}from"./index-1zDOBkBK.js";import"./mui-emotion-vendor-rwx6c2Wh.js";import"./react-vendor-C_Qvy3u4.js";import"./utils-B2F6Xi6s.js";const h={getMemberPermission:async r=>{try{return(await d.get(`/user-domain-permissions/member/${r}`)).data}catch(e){throw console.error("도메인 권한 조회 실패:",e),e}},grantPermission:async r=>{try{return(await d.post("/user-domain-permissions/grant",r)).data}catch(e){throw console.error("도메인 권한 부여 실패:",e),e}},delegatePermission:async r=>{try{return(await d.post("/user-domain-permissions/delegate",r)).data}catch(e){throw console.error("도메인 권한 위임 실패:",e),e}},assignDomain:async r=>{try{return(await d.post("/user-domain-permissions/assign-domain",r)).data}catch(e){throw console.error("도메인 할당 실패:",e),e}},revokePermission:async(r,e)=>{try{return(await d.delete(`/user-domain-permissions/revoke/${r}`,{data:{revoked_by:e}})).data}catch(p){throw console.error("권한 회수 실패:",p),p}},handleMemberUpdate:async(r,e,p)=>{var y,f,w,_,P,$;const c=[];try{if(e.grantPermissionTo){const n=parseInt(e.grantPermissionTo),m=await(async(s,t)=>{const g=[],l=[s],u=new Set;for(;l.length>0;){const a=l.shift();if(!u.has(a)){u.add(a);try{const o=await d.get(`/members/${a}/children`);if(o.data.success&&o.data.data)for(const i of o.data.data)i.agent_level_id===t&&g.push(i),i.agent_level_id<t&&l.push(i.id)}catch(o){console.error(`회원 ${a}의 하위 조회 실패:`,o)}}}return g})(r,n);`${n}`;for(const s of m)try{const t=await h.grantPermission({member_id:s.id,granted_by:r,can_delegate:!0});c.push({type:"grant",success:!0,message:`${s.username}에게 권한 부여 완료`,target:s})}catch(t){console.error(`${s.username} 권한 부여 실패:`,t),c.push({type:"grant",success:!1,message:`${s.username} 권한 부여 실패`,target:s,error:(f=(y=t.response)==null?void 0:y.data)==null?void 0:f.error})}}if(e.delegatePermissionType){if(e.delegatePermissionType==="self"){const n=await h.delegatePermission({member_id:r,delegated_by:r,delegation_type:"self"});c.push({type:"delegate",success:!0,message:n.message})}else if(e.delegatePermissionType.startsWith("children_")){const n=parseInt(e.delegatePermissionType.replace("children_","")),m=await(async(s,t)=>{const g=[],l=[s],u=new Set;for(;l.length>0;){const a=l.shift();if(!u.has(a)){u.add(a);try{const o=await d.get(`/members/${a}/children`);if(o.data.success&&o.data.data)for(const i of o.data.data)i.agent_level_id===t&&g.push(i),i.agent_level_id<t&&l.push(i.id)}catch(o){console.error(`회원 ${a}의 하위 조회 실패:`,o)}}}return g})(r,n);`${n}`;for(const s of m)try{`${s.username}${s.id}${r}${e.delegatePermissionType}`;const t=await h.delegatePermission({member_id:s.id,delegated_by:r,delegation_type:e.delegatePermissionType});c.push({type:"delegate",success:!0,message:`${s.username}에게 위임 완료`,target:s})}catch(t){console.error(`${s.username} 위임 실패:`,t),c.push({type:"delegate",success:!1,message:`${s.username} 위임 실패`,target:s,error:(_=(w=t.response)==null?void 0:w.data)==null?void 0:_.error})}}}if(e.selectedDomainId!==void 0&&e.selectedDomainId!==""&&e.selectedDomainId!==null&&!e.grantPermissionTo&&!e.delegatePermissionType){const n=await h.assignDomain({member_id:r,domain_id:e.selectedDomainId?parseInt(e.selectedDomainId):null});c.push({type:"assign",success:!0,message:n.message})}return{success:!0,results:c}}catch(n){return console.error("도메인 권한 업데이트 실패:",n),{success:!1,error:(($=(P=n.response)==null?void 0:P.data)==null?void 0:$.error)||"도메인 권한 업데이트 중 오류가 발생했습니다.",results:c}}}};export{h as default};
