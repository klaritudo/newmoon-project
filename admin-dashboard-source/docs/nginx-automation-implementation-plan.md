# Nginx ÏûêÎèôÌôî Íµ¨ÌòÑ Í≥ÑÌöçÏÑú
> ÎèÑÎ©îÏù∏ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖúÍ≥º Nginx ÏÑ§Ï†ï ÏûêÎèôÌôîÎ•º ÏúÑÌïú ÏµúÏ¢Ö Íµ¨ÌòÑ Í≥ÑÌöç

## üìã Executive Summary

### ÌòÑÏû¨ ÏÉÅÌô©
- **Î¨∏Ï†úÏ†ê**: ÎèÑÎ©îÏù∏ ÏÑ§Ï†ï ÌéòÏù¥ÏßÄÏóêÏÑú ÎèÑÎ©îÏù∏ Ï∂îÍ∞Ä/ÏàòÏ†ï/ÏÇ≠Ï†ú Ïãú DBÎßå ÏóÖÎç∞Ïù¥Ìä∏ÎêòÍ≥† Nginx ÏÑ§Ï†ïÏùÄ ÏàòÎèôÏúºÎ°ú Ìï¥Ïïº Ìï®
- **ÏòÅÌñ•**: ori.qnuta.com, sub.qnuta.com, user1.qnuta.com Îì±Î°ùÌñàÏßÄÎßå Ï†ëÏÜç Î∂àÍ∞Ä
- **Í∑ºÎ≥∏ ÏõêÏù∏**: ÎèÑÎ©îÏù∏ Í¥ÄÎ¶¨ÏôÄ Nginx ÏÑ§Ï†ïÏù¥ Ïó∞ÎèôÎêòÏßÄ ÏïäÏùå

### Ï†úÏïà ÏÜîÎ£®ÏÖò
**ÎßàÏù¥ÌÅ¨Î°úÏÑúÎπÑÏä§ Í∏∞Î∞ò Nginx Í¥ÄÎ¶¨ ÏûêÎèôÌôî ÏãúÏä§ÌÖú**
- Í∂åÌïú Î∂ÑÎ¶¨Î•º ÌÜµÌïú Î≥¥ÏïàÏÑ± ÌôïÎ≥¥
- Í∏∞Ï°¥ ÏãúÏä§ÌÖúÍ≥º ÏôÑÏ†Ñ ÎèÖÎ¶ΩÏ†Å Ïö¥ÏòÅ
- Î°§Î∞± Î∞è Î≥µÍµ¨ Î©îÏª§ÎãàÏ¶ò ÎÇ¥Ïû•
- Ïã§ÏãúÍ∞Ñ ÎèôÍ∏∞Ìôî Î∞è Î™®ÎãàÌÑ∞ÎßÅ

## üèóÔ∏è ÏãúÏä§ÌÖú ÏïÑÌÇ§ÌÖçÏ≤ò

### ÌòÑÏû¨ ÏïÑÌÇ§ÌÖçÏ≤ò Î∂ÑÏÑù
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    ÌòÑÏû¨ ÏãúÏä§ÌÖú                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                      ‚îÇ
‚îÇ  Admin Dashboard (5173)  ‚îÄ‚îÄ> Admin API (5000)       ‚îÇ
‚îÇ         ‚îÇ                          ‚îÇ                 ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ ÎèÑÎ©îÏù∏ Í¥ÄÎ¶¨ UI         ‚îî‚îÄ‚îÄ DB ÏóÖÎç∞Ïù¥Ìä∏Îßå   ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  User Page (3001)       ‚îÄ‚îÄ> User API (3100)         ‚îÇ
‚îÇ                                                      ‚îÇ
‚îÇ  Nginx (/etc/nginx/)                                ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ ÏàòÎèô ÏÑ§Ï†ï ÌïÑÏöî (ÏûêÎèôÌôî ÏóÜÏùå)                    ‚îÇ
‚îÇ                                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Ï†úÏïà ÏïÑÌÇ§ÌÖçÏ≤ò
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  ÏûêÎèôÌôîÎêú ÏãúÏä§ÌÖú                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                      ‚îÇ
‚îÇ  Admin Dashboard ‚îÄ‚îÄ> Admin API                      ‚îÇ
‚îÇ                         ‚îÇ                            ‚îÇ
‚îÇ                         ‚îú‚îÄ‚îÄ DB ÏóÖÎç∞Ïù¥Ìä∏               ‚îÇ
‚îÇ                         ‚îî‚îÄ‚îÄ Message Queue            ‚îÇ
‚îÇ                              ‚îÇ                       ‚îÇ
‚îÇ                              ‚Üì                       ‚îÇ
‚îÇ                    Nginx Manager Service             ‚îÇ
‚îÇ                    (ÎèÖÎ¶Ω ÎßàÏù¥ÌÅ¨Î°úÏÑúÎπÑÏä§)                ‚îÇ
‚îÇ                         ‚îÇ                            ‚îÇ
‚îÇ                         ‚îú‚îÄ‚îÄ ÏÑ§Ï†ï ÏÉùÏÑ±                 ‚îÇ
‚îÇ                         ‚îú‚îÄ‚îÄ Ïú†Ìö®ÏÑ± Í≤ÄÏ¶ù               ‚îÇ
‚îÇ                         ‚îú‚îÄ‚îÄ Nginx Ï†ÅÏö©               ‚îÇ
‚îÇ                         ‚îî‚îÄ‚îÄ Î™®ÎãàÌÑ∞ÎßÅ                  ‚îÇ
‚îÇ                                                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîí Î≥¥Ïïà Í≥†Î†§ÏÇ¨Ìï≠

### 1. Í∂åÌïú Î∂ÑÎ¶¨ Ï†ÑÎûµ
```javascript
// Í∂åÌïú Î†àÎ≤® Ï†ïÏùò
const PERMISSION_LEVELS = {
  WEB_APP: 'standard',      // Admin API - DB ÏûëÏóÖÎßå
  QUEUE: 'message',         // Î©îÏãúÏßÄ ÌÅê - ÌÜµÏã†Îßå
  NGINX_MANAGER: 'elevated' // Nginx Manager - ÏãúÏä§ÌÖú ÌååÏùº Ï†ëÍ∑º
};
```

### 2. ÏûÖÎ†• Í≤ÄÏ¶ù Ï≤¥Í≥Ñ
```javascript
// ÎèÑÎ©îÏù∏ Í≤ÄÏ¶ù Í∑úÏπô
const domainValidation = {
  // DNS Ïù¥Î¶Ñ Í∑úÏπô Ï§ÄÏàò
  pattern: /^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?(\.[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,
  
  // ÏòàÏïΩÎêú ÎèÑÎ©îÏù∏ Ï∞®Îã®
  blacklist: ['localhost', '127.0.0.1', '0.0.0.0'],
  
  // ÏµúÎåÄ Í∏∏Ïù¥ Ï†úÌïú
  maxLength: 253,
  
  // ÏÑúÎ∏åÎèÑÎ©îÏù∏ ÍπäÏù¥ Ï†úÌïú
  maxSubdomainDepth: 5
};
```

### 3. ÌÖúÌîåÎ¶ø Í∏∞Î∞ò ÏÑ§Ï†ï ÏÉùÏÑ±
```javascript
// Nginx ÏÑ§Ï†ï ÌÖúÌîåÎ¶ø (Ïù∏Ï†ùÏÖò Î∞©ÏßÄ)
const nginxTemplate = {
  admin: `
server {
    listen 80;
    server_name {{DOMAIN}};
    
    location / {
        proxy_pass http://localhost:{{ADMIN_PORT}};
        # Î≥¥Ïïà Ìó§ÎçîÎì§...
    }
    
    location /api/ {
        proxy_pass http://localhost:{{API_PORT}}/;
        # Î≥¥Ïïà Ìó§ÎçîÎì§...
    }
}`,
  user: `
server {
    listen 80;
    server_name {{DOMAIN}};
    
    location / {
        proxy_pass http://localhost:{{USER_PORT}};
        # Î≥¥Ïïà Ìó§ÎçîÎì§...
    }
}`
};
```

## üíª Íµ¨ÌòÑ ÏÑ∏Î∂ÄÏÇ¨Ìï≠

### 1. Nginx Manager Service Íµ¨Ï°∞
```
/home/klaritudo/nginx-manager/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.js              # Î©îÏù∏ ÏóîÌä∏Î¶¨
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js          # ÏÑ§Ï†ï Í¥ÄÎ¶¨
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ templates.js      # Nginx ÌÖúÌîåÎ¶ø
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ queueService.js   # Î©îÏãúÏßÄ ÌÅê Ï≤òÎ¶¨
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nginxService.js   # Nginx Í¥ÄÎ¶¨
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validationService.js # Í≤ÄÏ¶ù Î°úÏßÅ
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.js         # Î°úÍπÖ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ backup.js         # Î∞±ÏóÖ/Î≥µÍµ¨
‚îÇ   ‚îî‚îÄ‚îÄ tests/
‚îÇ       ‚îî‚îÄ‚îÄ *.test.js         # ÌÖåÏä§Ìä∏ ÌååÏùºÎì§
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ README.md
```

### 2. Admin API ÏàòÏ†ïÏÇ¨Ìï≠

#### domains.js ÎùºÏö∞ÌÑ∞ ÏàòÏ†ï
```javascript
// /home/klaritudo/admin-api-source/routes/domains.js

const MessageQueue = require('../services/messageQueue');

// ÎèÑÎ©îÏù∏ Ï∂îÍ∞Ä
router.post('/add', authenticateToken, async (req, res) => {
  const connection = await pool.getConnection();
  try {
    await connection.beginTransaction();
    
    // Í∏∞Ï°¥ DB Ï†ÄÏû• Î°úÏßÅ...
    const result = await connection.query(insertQuery, values);
    
    // Nginx ÏûêÎèôÌôî Ï∂îÍ∞Ä
    await MessageQueue.publish('nginx.domain.add', {
      id: result.insertId,
      domain: domain_name,
      type: domain_type,
      status: status,
      timestamp: new Date()
    });
    
    await connection.commit();
    res.json({ success: true, message: 'ÎèÑÎ©îÏù∏Ïù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§' });
  } catch (error) {
    await connection.rollback();
    // ÏóêÎü¨ Ï≤òÎ¶¨...
  }
});

// ÎèÑÎ©îÏù∏ ÏàòÏ†ï
router.put('/update/:id', authenticateToken, async (req, res) => {
  // Ïú†ÏÇ¨Ìïú Ìå®ÌÑ¥ÏúºÎ°ú Íµ¨ÌòÑ
  // DB ÏóÖÎç∞Ïù¥Ìä∏ ÌõÑ MessageQueue.publish('nginx.domain.update', ...)
});

// ÎèÑÎ©îÏù∏ ÏÇ≠Ï†ú
router.delete('/delete/:id', authenticateToken, async (req, res) => {
  // Ïú†ÏÇ¨Ìïú Ìå®ÌÑ¥ÏúºÎ°ú Íµ¨ÌòÑ
  // DB ÏÇ≠Ï†ú ÌõÑ MessageQueue.publish('nginx.domain.delete', ...)
});
```

#### Message Queue ÏÑúÎπÑÏä§
```javascript
// /home/klaritudo/admin-api-source/services/messageQueue.js

const redis = require('redis');
const { promisify } = require('util');

class MessageQueue {
  constructor() {
    this.publisher = redis.createClient({
      host: process.env.REDIS_HOST || 'localhost',
      port: process.env.REDIS_PORT || 6379,
      password: process.env.REDIS_PASSWORD
    });
    
    this.publish = promisify(this.publisher.publish).bind(this.publisher);
  }
  
  async publishDomainEvent(event, data) {
    const message = JSON.stringify({
      event,
      data,
      timestamp: new Date(),
      retryCount: 0
    });
    
    await this.publish('nginx-updates', message);
    console.log(`Published ${event} event for domain: ${data.domain}`);
  }
}

module.exports = new MessageQueue();
```

### 3. Nginx Manager Service ÌïµÏã¨ Íµ¨ÌòÑ

#### Î©îÏù∏ ÏÑúÎπÑÏä§
```javascript
// /home/klaritudo/nginx-manager/src/index.js

const redis = require('redis');
const NginxService = require('./services/nginxService');
const ValidationService = require('./services/validationService');
const logger = require('./utils/logger');

class NginxManager {
  constructor() {
    this.nginxService = new NginxService();
    this.validator = new ValidationService();
    this.setupSubscriber();
  }
  
  setupSubscriber() {
    this.subscriber = redis.createClient({
      host: process.env.REDIS_HOST,
      port: process.env.REDIS_PORT,
      password: process.env.REDIS_PASSWORD
    });
    
    this.subscriber.subscribe('nginx-updates');
    this.subscriber.on('message', this.handleMessage.bind(this));
  }
  
  async handleMessage(channel, message) {
    try {
      const data = JSON.parse(message);
      logger.info(`Received event: ${data.event}`, data);
      
      // Í≤ÄÏ¶ù
      if (!this.validator.validateDomain(data.data.domain)) {
        throw new Error('Invalid domain format');
      }
      
      // Ï≤òÎ¶¨
      switch (data.event) {
        case 'nginx.domain.add':
          await this.nginxService.addDomain(data.data);
          break;
        case 'nginx.domain.update':
          await this.nginxService.updateDomain(data.data);
          break;
        case 'nginx.domain.delete':
          await this.nginxService.deleteDomain(data.data);
          break;
      }
      
      logger.info(`Successfully processed ${data.event}`);
    } catch (error) {
      logger.error('Message processing failed:', error);
      await this.handleError(data, error);
    }
  }
}
```

#### Nginx ÏÑúÎπÑÏä§
```javascript
// /home/klaritudo/nginx-manager/src/services/nginxService.js

const fs = require('fs').promises;
const { exec } = require('child_process');
const { promisify } = require('util');
const execAsync = promisify(exec);
const backup = require('../utils/backup');

class NginxService {
  constructor() {
    this.configPath = '/etc/nginx/sites-available/';
    this.enabledPath = '/etc/nginx/sites-enabled/';
    this.ports = {
      admin: 5173,
      user: 3001,
      api: 5000
    };
  }
  
  async addDomain(domainData) {
    const { domain, type } = domainData;
    
    // Î∞±ÏóÖ ÏÉùÏÑ±
    await backup.create();
    
    try {
      // ÏÑ§Ï†ï ÌååÏùº ÏÉùÏÑ±
      const config = this.generateConfig(domain, type);
      const filename = this.sanitizeFilename(domain);
      
      await fs.writeFile(
        `${this.configPath}${filename}`,
        config,
        'utf8'
      );
      
      // Ïã¨Î≥ºÎ¶≠ ÎßÅÌÅ¨ ÏÉùÏÑ±
      await execAsync(
        `ln -sf ${this.configPath}${filename} ${this.enabledPath}${filename}`
      );
      
      // Nginx ÏÑ§Ï†ï ÌÖåÏä§Ìä∏
      await this.testConfig();
      
      // Nginx Î¶¨Î°úÎìú
      await this.reloadNginx();
      
    } catch (error) {
      // Ïã§Ìå® Ïãú Î°§Î∞±
      await backup.restore();
      throw error;
    }
  }
  
  generateConfig(domain, type) {
    const template = type === 'admin' ? 
      this.getAdminTemplate() : 
      this.getUserTemplate();
    
    return template
      .replace(/{{DOMAIN}}/g, domain)
      .replace(/{{ADMIN_PORT}}/g, this.ports.admin)
      .replace(/{{USER_PORT}}/g, this.ports.user)
      .replace(/{{API_PORT}}/g, this.ports.api);
  }
  
  async testConfig() {
    const { stderr } = await execAsync('nginx -t');
    if (stderr && !stderr.includes('syntax is ok')) {
      throw new Error(`Nginx config test failed: ${stderr}`);
    }
  }
  
  async reloadNginx() {
    await execAsync('systemctl reload nginx');
  }
}
```

## üß™ ÌÖåÏä§Ìä∏ Ï†ÑÎûµ

### 1. Îã®ÏúÑ ÌÖåÏä§Ìä∏
```javascript
// ÎèÑÎ©îÏù∏ Í≤ÄÏ¶ù ÌÖåÏä§Ìä∏
describe('Domain Validation', () => {
  test('should accept valid domains', () => {
    expect(validate('example.com')).toBe(true);
    expect(validate('sub.example.com')).toBe(true);
  });
  
  test('should reject invalid domains', () => {
    expect(validate('localhost')).toBe(false);
    expect(validate('../../etc/passwd')).toBe(false);
  });
});
```

### 2. ÌÜµÌï© ÌÖåÏä§Ìä∏
```javascript
// E2E ÌîåÎ°úÏö∞ ÌÖåÏä§Ìä∏
describe('Domain Management E2E', () => {
  test('should add domain and configure nginx', async () => {
    // 1. APIÎ°ú ÎèÑÎ©îÏù∏ Ï∂îÍ∞Ä
    const response = await api.post('/domains/add', {
      domain: 'test.example.com',
      type: 'admin'
    });
    
    // 2. Nginx ÏÑ§Ï†ï ÌååÏùº ÌôïÏù∏
    const configExists = await fs.exists(
      '/etc/nginx/sites-available/test.example.com'
    );
    
    // 3. ÎèÑÎ©îÏù∏ Ï†ëÍ∑º ÌÖåÏä§Ìä∏
    const siteResponse = await fetch('http://test.example.com');
    
    expect(response.status).toBe(200);
    expect(configExists).toBe(true);
    expect(siteResponse.status).toBe(200);
  });
});
```

### 3. Î∂ÄÌïò ÌÖåÏä§Ìä∏
```yaml
# K6 Î∂ÄÌïò ÌÖåÏä§Ìä∏ ÏãúÎÇòÎ¶¨Ïò§
scenarios:
  domain_operations:
    executor: 'ramping-vus'
    stages:
      - duration: '2m', target: 10  # 10 ÎèôÏãú ÏûëÏóÖ
      - duration: '5m', target: 50  # 50 ÎèôÏãú ÏûëÏóÖ
      - duration: '2m', target: 0   # Ïø®Îã§Ïö¥
```

## üîÑ Î°§Î∞± Í≥ÑÌöç

### 1. ÏûêÎèô Î°§Î∞± Ìä∏Î¶¨Í±∞
- Nginx ÏÑ§Ï†ï ÌÖåÏä§Ìä∏ Ïã§Ìå®
- Nginx Î¶¨Î°úÎìú Ïã§Ìå®
- Ìó¨Ïä§Ï≤¥ÌÅ¨ 3Ìöå Ïó∞ÏÜç Ïã§Ìå®
- Î©îÎ™®Î¶¨ ÏÇ¨Ïö©Îüâ 90% Ï¥àÍ≥º

### 2. Î°§Î∞± ÌîÑÎ°úÏÑ∏Ïä§
```javascript
class BackupManager {
  async createBackup() {
    const timestamp = Date.now();
    const backupDir = `/var/backups/nginx/${timestamp}`;
    
    // Nginx ÏÑ§Ï†ï Î∞±ÏóÖ
    await execAsync(`cp -r /etc/nginx ${backupDir}`);
    
    // DB Ïä§ÎÉÖÏÉ∑
    await this.createDBSnapshot(timestamp);
    
    return timestamp;
  }
  
  async restore(timestamp) {
    // Nginx ÏÑ§Ï†ï Î≥µÏõê
    await execAsync(`cp -r /var/backups/nginx/${timestamp}/* /etc/nginx/`);
    
    // Nginx Î¶¨Î°úÎìú
    await execAsync('systemctl reload nginx');
    
    // ÏïåÎ¶º Î∞úÏÜ°
    await this.notifyAdmins('Rollback completed');
  }
}
```

## üìä Î™®ÎãàÌÑ∞ÎßÅ Î∞è ÏïåÎ¶º

### 1. Ìó¨Ïä§Ï≤¥ÌÅ¨ ÏóîÎìúÌè¨Ïù∏Ìä∏
```javascript
// GET /health
{
  "status": "healthy",
  "nginx": {
    "status": "running",
    "configTest": "passed",
    "lastReload": "2024-01-20T10:30:00Z"
  },
  "queue": {
    "connected": true,
    "pending": 0,
    "processed": 1234
  },
  "errors": {
    "last24h": 2,
    "last7d": 5
  }
}
```

### 2. Î©îÌä∏Î¶≠ ÏàòÏßë
- ÎèÑÎ©îÏù∏ ÏûëÏóÖ Ï≤òÎ¶¨ ÏãúÍ∞Ñ
- Nginx Î¶¨Î°úÎìú ÌöüÏàò
- ÏóêÎü¨Ïú® Î∞è Ìå®ÌÑ¥
- ÏãúÏä§ÌÖú Î¶¨ÏÜåÏä§ ÏÇ¨Ïö©Îüâ

### 3. ÏïåÎ¶º Ï°∞Í±¥
- ÏóêÎü¨Ïú® 5% Ï¥àÍ≥º
- Ï≤òÎ¶¨ ÏãúÍ∞Ñ 5Ï¥à Ï¥àÍ≥º
- ÌÅê ÎåÄÍ∏∞ Î©îÏãúÏßÄ 100Í∞ú Ï¥àÍ≥º
- Nginx Îã§Ïö¥ÌÉÄÏûÑ Í∞êÏßÄ

## üöÄ Î∞∞Ìè¨ Í≥ÑÌöç

### Phase 1: Í∞úÎ∞ú ÌôòÍ≤Ω (Week 1)
1. Nginx Manager Service Í∞úÎ∞ú
2. Admin API ÏàòÏ†ï
3. Îã®ÏúÑ ÌÖåÏä§Ìä∏ ÏûëÏÑ±
4. Î°úÏª¨ ÌôòÍ≤Ω ÌÖåÏä§Ìä∏

### Phase 2: ÌÖåÏä§Ìä∏ ÌôòÍ≤Ω (Week 2)
1. Docker Ïª®ÌÖåÏù¥ÎÑà Íµ¨ÏÑ±
2. ÌÜµÌï© ÌÖåÏä§Ìä∏ Ïã§Ìñâ
3. Î∂ÄÌïò ÌÖåÏä§Ìä∏
4. Î≥¥Ïïà Í≤ÄÏ¶ù

### Phase 3: Ïä§ÌÖåÏù¥Ïßï (Week 3)
1. Ïã§Ï†ú ÎèÑÎ©îÏù∏ÏúºÎ°ú ÌÖåÏä§Ìä∏
2. Î°§Î∞± ÏãúÎÇòÎ¶¨Ïò§ Í≤ÄÏ¶ù
3. Î™®ÎãàÌÑ∞ÎßÅ ÏÑ§Ï†ï
4. Î¨∏ÏÑúÌôî ÏôÑÎ£å

### Phase 4: ÌîÑÎ°úÎçïÏÖò (Week 4)
1. Î∞±ÏóÖ ÏÉùÏÑ±
2. Ï†êÏßÑÏ†Å Î∞∞Ìè¨
3. Î™®ÎãàÌÑ∞ÎßÅ Í∞ïÌôî
4. Ïö¥ÏòÅ Ïù¥Í¥Ä

## üìù ÏùòÏ°¥ÏÑ± Î∞è ÏöîÍµ¨ÏÇ¨Ìï≠

### ÏãúÏä§ÌÖú ÏöîÍµ¨ÏÇ¨Ìï≠
- Node.js 18+ (Admin API, Nginx Manager)
- Redis 7+ (Î©îÏãúÏßÄ ÌÅê)
- Nginx 1.24+ (Ïõπ ÏÑúÎ≤Ñ)
- Linux (Ubuntu 22.04 Í∂åÏû•)

### NPM Ìå®ÌÇ§ÏßÄ
```json
{
  "dependencies": {
    "redis": "^4.6.7",
    "winston": "^3.17.0",
    "joi": "^17.9.0",
    "dotenv": "^16.5.0",
    "node-cron": "^3.0.2"
  },
  "devDependencies": {
    "jest": "^30.0.5",
    "supertest": "^7.1.4"
  }
}
```

## ‚úÖ ÏÑ±Í≥µ ÏßÄÌëú

### Í∏∞Ïà†Ï†Å ÏßÄÌëú
- ‚úÖ ÎèÑÎ©îÏù∏ ÏûëÏóÖ ÏûêÎèôÌôîÏú®: 100%
- ‚úÖ ÌèâÍ∑† Ï≤òÎ¶¨ ÏãúÍ∞Ñ: <2Ï¥à
- ‚úÖ ÏóêÎü¨Ïú®: <1%
- ‚úÖ ÏãúÏä§ÌÖú Í∞ÄÏö©ÏÑ±: 99.9%

### ÎπÑÏ¶àÎãàÏä§ ÏßÄÌëú
- ‚úÖ Í¥ÄÎ¶¨Ïûê ÏûëÏóÖ ÏãúÍ∞Ñ: 90% Í∞êÏÜå
- ‚úÖ ÏÑ§Ï†ï Ïò§Î•ò: 95% Í∞êÏÜå
- ‚úÖ ÎèÑÎ©îÏù∏ ÌôúÏÑ±Ìôî ÏãúÍ∞Ñ: Ï¶âÏãú

## üéØ Í≤∞Î°†

Ïù¥ Íµ¨ÌòÑ Í≥ÑÌöçÏùÄ ÎèÑÎ©îÏù∏ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖúÍ≥º Nginx ÏÑ§Ï†ïÏùÑ ÏôÑÏ†ÑÌûà ÏûêÎèôÌôîÌïòÏó¨:

1. **ÏàòÎèô ÏûëÏóÖ Ï†úÍ±∞**: Í¥ÄÎ¶¨ÏûêÍ∞Ä ÎèÑÎ©îÏù∏ ÏÑ§Ï†ï ÌéòÏù¥ÏßÄÏóêÏÑú Ï∂îÍ∞Ä/ÏàòÏ†ï/ÏÇ≠Ï†úÌïòÎ©¥ Ï¶âÏãú Ï†ÅÏö©
2. **Î≥¥Ïïà Í∞ïÌôî**: Í∂åÌïú Î∂ÑÎ¶¨ÏôÄ ÏûÖÎ†• Í≤ÄÏ¶ùÏúºÎ°ú ÏãúÏä§ÌÖú Î≥¥Ïïà ÌôïÎ≥¥
3. **ÏïàÏ†ïÏÑ± Î≥¥Ïû•**: ÏûêÎèô Î∞±ÏóÖÍ≥º Î°§Î∞±ÏúºÎ°ú Ïû•Ïï† ÎåÄÏùë
4. **ÌôïÏû•ÏÑ± ÌôïÎ≥¥**: ÎßàÏù¥ÌÅ¨Î°úÏÑúÎπÑÏä§ Íµ¨Ï°∞Î°ú Ìñ•ÌõÑ ÌôïÏû• Ïö©Ïù¥

Íµ¨ÌòÑ Ïãú Í∏∞Ï°¥ ÏãúÏä§ÌÖúÏóê ÏòÅÌñ• ÏóÜÏù¥ Ï†êÏßÑÏ†ÅÏúºÎ°ú Ï†ÅÏö© Í∞ÄÎä•ÌïòÎ©∞, Ïã§Ìå® Ïãú Ï¶âÏãú Î°§Î∞± Í∞ÄÎä•Ìïú ÏïàÏ†ÑÌïú Íµ¨Ï°∞ÏûÖÎãàÎã§.

---
*ÏûëÏÑ±Ïùº: 2025-01-20*
*ÏûëÏÑ±Ïûê: System Architect*